{% extends 'main.html.twig' %}

{% block htmlhead %}
<link rel="stylesheet" href="{{ asset('leaflet/leaflet.css') }}" />
<script src="{{ asset('leaflet/leaflet.js') }}"></script>

<script>
{{ include('mfzch/scripts/generics.js.twig') }}
</script>
{% endblock %}

{% block main %}
<script>
if (typeof jQuery != 'undefined') {
	// enable block-level ajax disable
	$.mobile.ignoreContentEnabled = true;
}
</script>
<div data-role="page" id="main-page">
	<div role="main" class="ui-content" data-ajax="false">
		{% if is_granted('IS_AUTHENTICATED_FULLY') %}
			<h1>Profile for {{ app.user.username|e }}</h1>
			<p><a href="{{ path('edit-profile') }}">Edit Profile</a></p>

			<ul>
				<li>Real name: {{ app.user.profile_realname|e }}</li>
				<li>{{ app.user.email|e }}</li>
				{% if date(app.user.elite_expires) > date() %}
					<li>Elite User through {{ app.user.elite_expires|date("Y-m-d H:i:s") }} </li>
				{% else %}
					<li>Regular User</li>
				{% endif %}
				<li>Last login: {{ app.user.lastLogin()|date("Y-m-d H:i:s") }}</li>
				<li>Display Profile: {% if app.user.profile_is_public %}Yes{% else %}No{% endif %}</li>
				<li>Display E-mail: {% if app.user.profile_display_email %}Yes{% else %}No{% endif %}</li>
				<li>Patreon ID: {% if app.user.patreon_id %}{{ app.user.patreon_id }} &#8212; <a href="https://www.patreon.com/oauth2/authorize?response_type=code&client_id={{ patreon_client_id }}&redirect_uri={{ url('patreon-test') }}">Update Patreon Account</a>{% else %}None &#8212; <a href="https://www.patreon.com/oauth2/authorize?response_type=code&client_id={{ patreon_client_id }}&redirect_uri={{ url('patreon-test') }}">Connect Patreon Account</a>{% endif %}</li>

				<li>Game Preferences: {{ app.user.profile_game_preferences }}</li>
				<li>Materials: {{ app.user.profile_materials }}</li>
				<li>Experience: {{ app.user.profile_experience }}</li>

				<li>Location:<br />
					<div id="mapid" style="max-width: 40em; height: 30em; margin: 0 auto;"></div>
				</li>
			</ul>

			{# dump(app.user) #}
			{# {{ app.user.getRoles()|join(', ')|e }} #}

			{#
			<script>
			$(document).on("pagecontainershow", function(event, ui) {
				{% if app.user.geo_latitude and app.user.geo_longitude %}
					var mymap = L.map('mapid').setView([{{ app.user.geo_latitude|e }}, {{ app.user.geo_longitude|e }}], 7);
				{% else %}
					var mymap = L.map('mapid').setView([39.70719, -96.41602], 4);
				{% endif %}

				mymap.attributionControl.setPrefix('');

				var Stamen_Terrain = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}', {
					attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
					subdomains: 'abcd',
					minZoom: 0,
					maxZoom: 18,
					ext: 'png'
				});

				Stamen_Terrain.addTo(mymap);
				L.control.scale().addTo(mymap);

				var userIcon = L.divIcon({
					html: getIcon('frame', '#be1e2d'),
					iconSize: [36, 36]
				});

				var marker = L.marker([{{ app.user.geo_latitude|e }}, {{ app.user.geo_longitude|e }}], {icon: userIcon}).addTo(mymap);
			});
			</script>
			<style>
				#mapid .frame-icon {
					width: 3em;
					height: 3em;
				}
				#mapid .leaflet-div-icon {
					background: transparent;
					border: none;
				}
			</style>
			#}

		{% else %}
			<h1>Not logged in</h1>
		{% endif %}
	</div>
</div>
{% endblock %}